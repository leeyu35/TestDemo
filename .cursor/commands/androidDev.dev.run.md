---
description: 快速运行模式 - 编译 + 运行 + 基本验证
---

# /androidDev.dev.run 

## 用户输入

$ARGUMENTS

---

## 概述

快速开发迭代命令:
1. 编写代码实现功能
2. 自动编译部署
3. 运行APP并导航到目标页面
4. 截图确认基本可用

## 前置检查

检查 `.adevtools/config.json` 是否存在:

- **如果不存在**: 自动执行初始化流程(按 /androidDev.init 的阶段1-2 执行),生成配置文件后继续
- **如果存在**: 加载配置信息

读取 `.adevtools/routes.md`:
- 加载页面路由配置, 用于匹配页面入口

## 阶段1: 代码实现

### 步骤1: 理解需求

解析用户输入:
- 要实现什么功能
- 涉及哪些文件或类
- 关联哪个页面入口(从路由配置匹配)

### 步骤2: 分析现有代码与依赖

读取相关源文件:
- 理解当前架构和代码风格
- 分析调用链路
- **检查 `build.gradle` 的 dependencies**: 确认可用依赖

**增量编译限制**:
- 禁止添加新的Maven仓库或依赖库
- 只能使用项目已有依赖和Android原生组件

### 步骤3: 设计实现方案

根据分析结果:
- 列出需要的组件,确认都可用(已有依赖或原生)
- 不可用时设计替代方案(参考"注意事项-依赖检查")

### 步骤4: 编写代码

遵循现有代码风格，实现功能


## 阶段2: 编译检查

在进行打包部署前，先进行快速编译检查以尽早发现错误。

### 执行编译检查

运行编译检查脚本：
```bash
sh /path/to/.adevtools/android-compile.sh
```

**脚本功能**：
- 只编译 Java 和 Kotlin 代码，不生成 APK
- 使用 Gradle Daemon 和增量编译加速
- 快速发现编译错误（通常 7-30 秒）

### 处理结果

**如果编译通过**：
- 继续进行阶段3的完整编译部署

**如果编译失败**：
- 修复代码后重新执行编译检查
- 直到编译通过后再进行完整编译部署

---

## 阶段3: 编译部署

### 使用异步构建脚本

长时间构建任务使用异步构建脚本避免超时:

**启动构建**:
```bash
bash .cursor/commands/scripts/async_run_build.sh start
```

**查询构建状态**:
```bash
bash .cursor/commands/scripts/async_run_build.sh status
```

轮询间隔: 前2分钟建议20-40秒, 之后建议5-10秒

### 编译失败处理

编译失败时按以下顺序排查:
- 新依赖检查: 是否添加了不存在的依赖
- 语法错误: 检查代码语法
- 导入错误: 检查import语句
- 编译命令: 确认buildCommand正确

修复后重新编译,直到成功。

---

## 阶段4: 运行验证

### 步骤1: 启动APP并导航

1. 使用 `open_url`(从routes.md获取URL,指定packageName,waitSeconds≥5)
2. 截图确认页面状态

### 步骤2: 基本验证

1. 检查页面是否正常显示
2. 检查是否有崩溃
3. 截图记录最终状态


## 阶段5: 输出总结

展示简要摘要:

```
=== 完成 ===

修改文件:
- [文件列表]

验证结果:
✓ 编译通过, APP运行正常
✓ 页面已显示
```

---

## MCP 工具使用

### 配置集成

- 读取 `.adevtools/config.json`(包名、编译命令)
- 读取 `.adevtools/routes.md`(页面路由、URL)

### 失败处理

- **编译失败**: 检查是否添加新依赖,修复,重新编译
- **运行失败**: 截图显示错误,提示用户检查
- **操作失败**: press_key(key="back"),重新分析页面,尝试其他定位方式

---

## 注意事项

### 通用规则
1. 编译失败持续修复直到成功
2. 所有配置从配置文件读取

### 依赖检查(重要)

**增量编译限制**:
- 严禁添加Maven仓库或依赖库
- 只能使用已有依赖和Android原生组件

**检查方法**: 编码前读取 `build.gradle` 确认依赖可用性

### MCP操作技巧
- 页面加载等待不少于5秒
- 元素定位顺序: text、resourceId、hierarchyId

### 编译注意
在进行编译的时候可能需要等待异步脚本的执行,等待的时间不允许超过30秒,否则Agent的执行很容易超时导致任务中断

### 快速运行模式说明

**适合场景**:
- 快速迭代: 改代码 → run → 改代码 → run
- 视觉调整: UI修改后快速查看效果
- 基本验证: 确认编译通过、APP启动

**不适合场景**:
- 需要详细功能验证
- 需要复杂的交互测试
